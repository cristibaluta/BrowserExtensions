<!DOCTYPE HTML>
<html>
<head>
<title></title>
<script type="text/javascript">

safari.application.addEventListener("command", performCommand, false);
safari.application.addEventListener("validate", validateCommand, false);
safari.application.addEventListener("message", copyReviewers, false);

function performCommand(event) {
	
    if (event.command == "reviewers_copy") {
		safari.application.activeBrowserWindow.activeTab.page.dispatchMessage('copyReviewers', null);
    } else if (event.command == "reviewers_paste") {
    	safari.application.activeBrowserWindow.activeTab.page.dispatchMessage('pasteReviewers', safari.extension.settings.reviewers);
    }
}

function validateCommand(event) {
    if (event.command == "reviewers_copy") {
        event.target.title = 'Copy reviewers';
	} else if (event.command !== "reviewers_paste") {
		event.target.title = 'Paste reviewers';
	}
}

function copyReviewers(e) {
	safari.extension.settings.reviewers = e.message;

	alert(aui);
	alert(aui.avatar);
	alert(aui.avatar.avatar);
}

</script>
</head>
</html>